# 产品编码管理系统

一个用于管理产品编码的全栈应用，采用前后端分离架构。

## 技术栈

### 后端
- Node.js
- Express
- MongoDB (可选，默认使用文件系统存储)
- RESTful API

### 前端
- React
- React Router
- Ant Design
- Axios
- Chart.js

## 功能特性

- 产品管理：添加、删除、查看产品
- 编码管理：为产品添加编码、删除编码、查看编码列表
- 统计功能：显示总产品数、总编码数、今日活动数
- 扫码功能：支持扫描二维码/条形码添加编码
- 快速录入：支持使用扫码枪快速录入编码，无需打开模态框
- 重复检测：自动检测重复编码，防止用户录入重复数据
- 确认机制：重复编码需用户确认后才能继续录入，防止遗漏
- 导出功能：支持导出编码到Excel文件
- 搜索筛选：支持按名称搜索产品和编码，按分类筛选产品
- 缺失编码检测：自动检测并显示编码范围内的缺失编码
- 数据可视化：使用图表展示产品分类分布和活动统计

## 项目结构

```
产品编码管理系统/
├── client/                  # 前端React应用
│   ├── public/              # 静态资源
│   └── src/                 # 源代码
│       ├── components/      # React组件
│       ├── config/          # 配置文件
│       ├── pages/           # 页面组件
│       ├── services/        # API服务
│       └── utils/           # 工具函数
│
├── server/                  # 后端Node.js应用
│   └── src/                 # 源代码
│       ├── controllers/     # 控制器
│       ├── models/          # 数据模型
│       ├── routes/          # 路由定义
│       └── services/        # 业务逻辑
│
├── data/                    # 数据存储目录（使用文件系统存储时）
├── start-server.bat         # 服务器启动脚本
├── start-client.bat         # 客户端启动脚本
└── README.md                # 项目说明
```

## 安装与运行

### 快速启动

使用提供的批处理文件快速启动应用：

1. 启动后端服务器：双击运行 `start-server.bat`
2. 启动前端开发服务器：双击运行 `start-client.bat`

### 手动安装

#### 安装依赖

```bash
# 安装后端依赖
cd server
npm install

# 安装前端依赖
cd ../client
npm install
```

#### 运行应用

```bash
# 运行后端服务器
cd server
npm run dev

# 运行前端开发服务器
cd ../client
npm start
```

### 构建生产版本

```bash
# 构建前端
cd client
npm run build

# 运行生产版本
cd ../server
npm start
```

## Docker 部署

本系统支持使用 Docker 和 Docker Compose 进行容器化部署，这是生产环境推荐的部署方式。

### 前置条件
- 确保本机已安装 [Docker](https://www.docker.com/products/docker-desktop) 和 [Docker Compose](https://docs.docker.com/compose/install/)。

### 方式一：使用 Docker Compose (推荐)

在项目根目录下，运行以下命令一键启动所有服务（应用服务 + MongoDB）：

```bash
docker-compose up -d
```

启动后，访问 `http://localhost:5000` 即可使用系统。

#### 代码更新与镜像重建

当您修改了代码或拉取了最新代码 (`git pull`) 后，需要重新构建 Docker 镜像以应用更改。请执行以下命令：

```bash
# 强制重新构建镜像并后台启动
docker-compose up -d --build
```

此命令会自动检测代码变更，重新构建 `api` 服务镜像，并重建容器。

#### 常用管理命令

```bash
# 查看服务日志
docker-compose logs -f

# 停止所有服务
docker-compose down
```

### 方式二：手动使用 Docker 命令部署

如果您不想使用 docker-compose，也可以使用原生 Docker 命令手动构建和运行容器。

#### 1. 构建镜像

首先在项目根目录下构建应用镜像：

```bash
docker build -t htsm-dms .
```

#### 2. 启动 MongoDB

启动 MongoDB 容器（如果您已有外部 MongoDB，可跳过此步）：

```bash
# 启动 MongoDB 容器，并将数据持久化到 mongo-data 卷
docker run -d --name htsm-mongo -p 27017:27017 -v mongo-data:/data/db mongo:6
```

#### 3. 启动应用

启动应用容器并链接到 MongoDB：

```bash
# 启动应用容器
# --link htsm-mongo:mongo 将 MongoDB 容器链接为 hostname "mongo"
# -e MONGODB_URI=... 设置连接字符串
docker run -d \
  --name htsm-app \
  -p 5000:5000 \
  --link htsm-mongo:mongo \
  -e MONGODB_URI=mongodb://mongo:27017/htsm-dms \
  htsm-dms
```

> **注意**：如果您使用外部 MongoDB，请将 `MONGODB_URI` 环境变量修改为实际的数据库连接字符串，并确保容器能够访问该地址。

## 配置

- 后端配置：修改 `server/.env` 文件
- 前端配置：修改 `client/src/config/index.js` 文件

## 数据存储

系统默认使用文件系统存储数据，数据文件保存在 `data` 目录下。如果需要使用MongoDB，请在 `server/.env` 文件中配置MongoDB连接字符串。

## 使用指南

### 快速录入编码

系统提供了快速录入编码的功能，特别适合使用扫码枪进行批量录入：

1. 进入产品详情页面
2. 在页面顶部的"快速添加"输入框中，使用扫码枪扫描条码
3. 系统会自动捕获扫码结果并提交，无需点击按钮
4. 扫描完成后，输入框会自动清空并重新获得焦点，方便连续扫码

这种方式比传统的模态框录入更加高效，特别适合大批量编码录入场景。

### 重复编码检测

系统具有重复编码检测功能，防止用户录入重复的编码数据：

1. 当用户尝试录入已存在的编码时，系统会立即检测到并显示警告提示
2. 警告提示包括红色错误信息和声音提示，确保用户能够注意到
3. 重复的编码不会被提交，用户可以看到重复的编码内容
4. 系统会弹出确认对话框，要求用户确认是否继续录入其他编码
5. 用户可以选择"继续录入"（清空当前输入并继续）或"取消"（保留当前输入）

这个功能可以有效防止数据重复，提高数据质量，同时避免用户在批量录入过程中遗漏编码。确认机制确保用户必须对重复编码做出明确处理，防止因疏忽而错过重要信息。

### 扫码添加

对于需要查看扫描结果后再确认添加的情况，系统也提供了传统的扫码模式：

1. 点击"扫码添加"按钮
2. 在弹出的模态框中使用摄像头扫描条码
3. 确认扫描结果无误后，点击"使用扫描结果"按钮

### 批量选择删除

系统支持产品和编码的批量操作：

1. **产品批量删除**：在产品管理页面点击"批量选择"，选择多个产品后批量删除
2. **编码批量删除**：在产品详情页面点击"批量选择"，选择多个编码后批量删除
3. **全选功能**：支持一键全选/取消全选
4. **选中状态**：选中的项目会有蓝色边框和背景色提示

## 开发计划与TODO

### 🎯 已完成功能
- ✅ 产品管理：添加、删除、查看、搜索、分类筛选
- ✅ 编码管理：添加、删除、查看、搜索、导出Excel
- ✅ 扫码功能：摄像头扫码、扫码枪快速录入
- ✅ 重复检测：自动检测重复编码，声音提示
- ✅ 批量操作：产品和编码的批量选择删除
- ✅ 数据可视化：统计图表、产品分类分布
- ✅ 缺失编码检测：自动检测并显示编码范围内的缺失编码
- ✅ 超出范围检测：显示超出编码范围的编码
- ✅ 真实数据统计：最近7天活动图表使用真实数据

### 🚀 待实现功能（按优先级排序）

#### 高优先级
- [ ] **数据备份与恢复**
  - [ ] 自动备份：定期自动备份数据
  - [ ] 手动备份：用户可手动导出完整数据
  - [ ] 数据恢复：支持从备份文件恢复数据
  - [ ] 历史版本：保留多个备份版本

- [ ] **用户权限管理**
  - [ ] 用户登录/注册系统
  - [ ] 角色权限控制（管理员/操作员）
  - [ ] 操作日志记录
  - [ ] 数据访问控制

- [ ] **高级搜索功能**
  - [ ] 编码范围搜索（如：100-200）
  - [ ] 日期范围筛选
  - [ ] 多条件组合搜索
  - [ ] 搜索历史记录
  - [ ] 保存搜索条件

#### 中优先级
- [ ] **移动端优化**
  - [ ] 响应式设计优化
  - [ ] 触摸操作优化
  - [ ] 移动端扫码优化
  - [ ] PWA支持（离线使用）

- [ ] **数据导入功能**
  - [ ] Excel批量导入产品
  - [ ] Excel批量导入编码
  - [ ] 导入数据验证
  - [ ] 导入错误报告

- [ ] **模板管理**
  - [ ] 产品模板（快速创建相似产品）
  - [ ] 编码规则模板
  - [ ] 批量导入模板
  - [ ] 自定义字段支持

#### 低优先级
- [ ] **数据同步**
  - [ ] 多用户实时数据同步
  - [ ] 冲突检测与解决
  - [ ] 操作锁定机制
  - [ ] WebSocket实时通信

- [ ] **报表系统**
  - [ ] 自定义报表生成
  - [ ] 图表可视化扩展
  - [ ] 定期报表邮件
  - [ ] 数据对比分析

- [ ] **标签系统**
  - [ ] 多标签支持
  - [ ] 标签颜色管理
  - [ ] 标签统计
  - [ ] 智能标签推荐

### 🎨 UI/UX 改进计划
- [ ] **界面优化**
  - [ ] 主题切换：支持深色/浅色主题
  - [ ] 快捷键：常用操作快捷键支持
  - [ ] 草稿保存：表单自动保存草稿
  - [ ] 操作撤销：支持撤销最近操作

- [ ] **交互优化**
  - [ ] 手势支持：滑动删除、长按选择
  - [ ] 音效反馈：操作成功/失败音效
  - [ ] 动画效果：页面切换动画
  - [ ] 位置记忆：记住用户浏览位置

### 🛡️ 系统健壮性改进
- [ ] **错误处理**
  - [ ] 网络异常处理优化
  - [ ] 离线模式支持
  - [ ] 数据验证增强
  - [ ] 友好错误提示

- [ ] **安全性增强**
  - [ ] API接口鉴权
  - [ ] 数据加密存储
  - [ ] 操作审计日志
  - [ ] 防止SQL注入

- [ ] **性能优化**
  - [ ] 虚拟滚动（处理大量数据）
  - [ ] 分页加载优化
  - [ ] 搜索防抖处理
  - [ ] 图片懒加载

### 🚀 部署与运维改进
- [x] **容器化部署**
  - [x] Docker配置
  - [x] Docker Compose
  - [ ] 环境配置管理
  - [x] 自动化部署脚本

- [ ] **监控告警**
  - [ ] 系统健康检查
  - [ ] 性能监控
  - [ ] 错误告警
  - [ ] 使用量统计

### 💡 立即可实现的小改进
- [ ] 添加键盘快捷键支持
- [ ] 增加操作确认的详细信息
- [ ] 优化加载状态显示
- [ ] 添加系统使用帮助文档
- [ ] 增加数据导入功能

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 开发环境设置
1. Fork 这个仓库
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

### 代码规范
- 使用 ESLint 进行代码检查
- 遵循现有的代码风格
- 为新功能添加适当的注释
- 确保所有测试通过

## 版本历史

### v1.0.0 (当前版本)
- 基础产品编码管理功能
- 扫码功能支持
- 批量操作支持
- 数据可视化
- 真实数据统计

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 联系方式

- 项目维护者：A1_Panda
- 公司：航天石墨有限公司